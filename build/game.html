<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="情人節又要到了，每個人心中一定有個特別人，如果你有段話想對她、他說，但又有不知道如何開口，讓我們來幫你吧。" />
    
    <title>情人節網路告白大行動</title>

    <link href="assets/images/favicon.ico" rel="icon" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/1.7.3/semantic.min.css">

    <style type="text/css">
    #wraper {
        width: 80%;
        margin: 0 auto;
        box-shadow: 0 0 0 0;
        height: 100%;
    }
    .input{
        width: 100%;
        margin: 2em 0;
    }
    .login {
        text-align:center;
    }
    .flow {
        display:none;
    }
    .flow .steps {
        width: 100%;
    }
    #msg.msg, #link.link {
        display:none;
    }

    body {
        background-image: url('http://lh5.ggpht.com/LiPAfqM1Gh8tPkXieRNnbdZLO3NfAf4-WykbHHeH784bgg54wPLAArvR-lkr4gK7GudzEDnd_56sd1PtdDXneA');
    }

    .logo {
        background-image: url('http://lh4.ggpht.com/BHbINrjedbJUmPHbpvop_4yFbALLYqttydPRldxaG7KAPVbuH-zr8vqnoDe2s-RZVYm7ApeyocDdu1zhLuei');
        width: 140px;
        height: 117px;
        margin: 50px auto 50px auto;
    }

    .top {
        background-image: url('http://lh4.ggpht.com/MNrKJzB8ZzRLvYEfW3abp02_3zJ5UY2eTqxzI42lv4kpkC7PEh-9hjCUl38tS6v3ngIjLpgU6ZWufZtQMBYPzw');
        width: 100%;
        height: 20px;
    }

    .bottom {
        text-align: center;
        widows: 100%;
        height: 50px;
        background-color: #FFB5B5;
    }

    .bottom p {
        line-height: 50px;
        font-size: 12px;
        color: #5A5A5A;
    }

    ul {
        list-style-type:none;
        padding: 0;
        font-size: 15px;
    }

    p {
        font-size: 20px;
        color: #BA8A68;
        line-height: 30px;
    }
    
    h2 {
        text-align: center;
    }

    iframe {
        margin: 0 auto;
        display: block;
        /*outline: 3px solid;*/
    }

    .flow-wraper {
        max-width: 600px;
        margin: 50px auto;
    }


    .fb-share-button {
        position: absolute !important;
        top: 10px;
        right: 16px;
    }
    .fb-comments, .fb-like-box{
        text-align: center;
        display: block !important;
        margin: 0 auto;
    }

    #ads iframe {
        outline: 1px solid;
    }

    .sp {
        font-size: 30px;
        color: #5F5F5F;
        margin-right: 10px;
    }

    .list {
        font-size: 14px;
        color: #279BFC;
        line-height: 25px;
    }
    
    .list li {
        color: #000000;
        font-size: 14px;
        line-height: 30px;
    }

    .index {
        background-image: url('http://lh3.ggpht.com/_wf24KChsm560xm_tvtaGMtON7mLYBzO_6rIZSecNZEFZH9QXVARoC4u5tQSlq2EpHRZf4VL6FVE_4EXYwZZT-w');
        width: 17px;
        height: 20px;
        display: inline-block;
        position: relative;
        top: 7px;
        background-size: 100%;
        margin-right: 5px;
    }

    .title {
        font-size: 16px;
    }
    </style>

</head>

<body>
<div class="ui inline cookie nag" style="position:fixed;border-radius:0px;">
  <span class="title">
    目前已有 <span id="num"></span> 個人告白成功!!! 快來告白吧~
  </span>
  <!--i class="close icon"></i-->
</div>
    <div class="top"></div>

    <div id="wraper" class="ui compact segment">
        <div class="logo"></div>
        <!--div class="fb-share-button" data-href="https://developers.facebook.com/docs/plugins/" data-layout="button_count"></div-->
        <div class="fb-share-button" data-href="http://ad.tagtoo.co/valentine_game.html" data-layout="button"></div>
        <div class="ui vertical segment" style="box-shadow: 0 0px 0 rgba(39,41,43,.15) inset;">
          <div class="ui page grid">
            <div class="column">
              <h2 class="ui inverted header">Full Width Heading</h2>
              <p>情人節要到了，每個人心中一定有個<class class="sp" style="margin:10px;">特別</class>的人。</p>

              <p style="text-align:justify">如果你有段話想對她(他)說，但又不知道如何開口，讓我們來幫你吧。只要依照以下步驟，先登入臉書帳號，再輸入告白對象暱稱，並寫下一段你想對她說的話，系統會自動產出一個短網址。</p>
              <p>你只要把產出網址丟給你想要告白的對象，我們就會把你的告白內容做成「網路廣告」並投放給你的告白對象！</p>
              <p><span class="sp">重點是</span>這段秘密對話，只有點連結的那個人看的到，其他人是看不到的喔。適用對象：不管是暗戀、單戀、情人、男男、女女、還是老夫老妻，只要你想給某人一個不一樣的情人節禮物，都可以免費參加遊戲。</p>
            </div>
          </div>
        </div>

        <div class="ui vertical segment" style="box-shadow: 0 0px 0 rgba(39,41,43,.15) inset;">
          <div class="ui page grid">
            <div class="sixteen wide column">
                <ul class="list">
                    <li><span class="index"></span>活動期間：即日起到情人節當天為止 (2/14/2015)。</li>
                    <li><span class="index" style="background-position-y:135px;"></span>活動要求：要特別告訴告白對象，點短網址的時候要在桌機上喔，目前活動並不支援行動裝置。</li>
                    <li><span class="index" style="background-position-y:35px;"></span>特別提示：如果想要傳給多個對象，每次都要產生新的網址喔，要不然後果可能會難以想像。</li>
                    <li><span class="index" style="background-position-y:19px;top: 5px;"></span>此活動由塔圖科技贊助，塔圖科技是一間提供精准廣告投遞的廣告技術公司，如果想了解更多關於廣告投放資訊，請造訪 <a href="http://www.tagtoo.com.tw">塔圖官方網站</a>。</li>
                </ul>
                <div class="fb-like-box" data-href="https://www.facebook.com/TagtooFans" data-width="700" data-colorscheme="light" data-show-faces="true" data-header="false" data-stream="false" data-show-border="false"></div>
        
            </div>
          </div>
        </div>

        <div id="ads" class="ui vertical segment" style="box-shadow: 0 0px 0 rgba(39,41,43,.15) inset;">
          <div class="ui page grid">
            <div class="ui horizontal divider">
                告白廣告示意圖
            </div>
            <div class="sixteen wide column">
                <h2>告白 A 版型</h2>
                <iframe src="http://ad.tagtoo.co/ad/show/1669" frameborder="0" width="620" height="150" frameborder="0" scrolling="no"></iframe>
                
                <h2>告白 B 版型</h2>
                <iframe src="http://ad.tagtoo.co/ad/show/1668" frameborder="0" width="300" height="250" frameborder="0" scrolling="no"></iframe>
            </div>

            <div class="eight wide column">
                <h2>告白 C 版型</h2>
                <iframe src="http://ad.tagtoo.co/ad/show/1670" frameborder="0" width="120" height="600" frameborder="0" scrolling="no"></iframe>
            </div>
            <div class="eight wide column">
                <h2>告白 D 版型</h2>
                <iframe src="http://ad.tagtoo.co/ad/show/1671" frameborder="0" width="160" height="600" frameborder="0" scrolling="no"></iframe>
            </div>
          </div>
        </div>

        <div class="ui vertical segment" style="box-shadow: 0 0px 0 rgba(39,41,43,.15) inset;">
          <div class="ui page grid">
            <div class="sixteen wide column">
                <div class="ui horizontal divider">
                    start
                </div>
                <div class="flow-wraper">
                    <div class="login">
                        <div id="login" class="ui facebook button massive" onclick="VALENTINE.login();">
                            <i class="facebook icon"></i> 大聲告白
                        </div>
                    </div>

                    <div id="flow" class="flow">

                        <div class="ui ordered steps">
                            <div id="step1" class="active step">
                                <div class="content">
                                    <div class="title">對誰告白</div>
                                    <div class="description">輸入你想要告白的對象</div>
                                </div>
                            </div>
                            <div id="step2" class="disabled step">
                                <div class="content">
                                    <div class="title">告白吧</div>
                                    <div class="description">輸入你想要告白的內容</div>
                                </div>
                            </div>
                            <div id="step3" class="disabled step">
                                <div class="content">
                                    <div class="title">恭喜</div>
                                    <div class="description">把連結分享給你的告白對象</div>
                                </div>
                            </div>
                        </div>

                        <div id="name" class="ui left icon action input name">
                            <i class="user icon"></i>
                            <input type="text" placeholder="你要告白的對象名稱">
                            <div class="ui blue submit button">確認</div>
                        </div>
                        <div id="msg" class="ui left icon action input msg">
                            <i class="smile icon"></i>
                            <input type="text" placeholder="你要告白的內容">
                            <div class="ui blue submit button">確認</div>
                        </div>
                        <div id="link" class="ui action input link">
                            <input type="text">
                            <div id="copy-button" class="ui blue submit button" data-clipboard-text="Copy Me～～">copy</div>
                        </div>
                        
                    </div>

                </div>
            </div>
          </div>
        </div>


        <div class="ui vertical segment" style="box-shadow: 0 0px 0 rgba(39,41,43,.15) inset;">
          <div class="ui page grid">
            <div class="sixteen wide column">
                <div class="fb-comments" data-href="http://ad.tagtoo.co/valentine_game.html" data-width="600" data-numposts="5" data-colorscheme="light"></div>
            </div>
          </div>
        </div>

    </div>
    
    <div class="bottom">
        <p>© 2015 <a href="http://www.tdagtoo.com.tw" style="margin: 5px;">Tagtoo 塔圖科技</a> All copyright <a href="http://www.tagtoo.com.tw/privacy" style="margin: 5px;">隱私權政策</a></p>
    </div>

    <script src="/valentine_static/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/1.7.3/semantic.min.js"></script>
    <script src="/valentine_static/ZeroClipboard.js"></script>
    <script type="text/javascript"> 
    var VALENTINE = {
        num: 0,
        resourse: "/valentine/api/valentineinfo",
        id: undefined,
        photo: undefined,
        name: undefined,
        fbid: undefined,
        success: 0,

        login: function () {

            var that = this;

            FB.login(function(response) {

                if (response.authResponse) {

                    console.log('Welcome!  Fetching your information.... ');
                    //console.log(response); // dump complete info
                    access_token = response.authResponse.accessToken; //get access token
                    user_id = response.authResponse.userID; //get FB UID

                    FB.api('/me', function(response) {
                        console.log('Successful login for: ' + response.id);
                        that.name = response.name;
                        that.fbid = response.id;
                        that.display();        
                    });

                    FB.api('/me/picture?width=200', function(response) {
                        that.photo = response.data.url;
                        that.display();             
                    });

                } else {
                    //user hit cancel button
                    console.log('User cancelled login or did not fully authorize.');

                }

            }, {
                scope: 'publish_stream,email,user_about_me,user_photos'
            });
        },


        display: function () {

            this.num+=1;

            if(this.num == 2) {
                $('#login').css('display','none');
                $('#flow').css('display','block');
            }
        },

        finish: function (obj, o) {
            $(obj).removeClass('active').addClass('completed');
            $(o).css('display','none');
        },

        start: function (obj, o) {
            $(obj).removeClass('disabled').addClass('active');
            $(o).css('display','table');
        },

        nameConfirm: function (event) {
            // if(event.type == 'click' || event.which == 13 ) {            
                var name = $('#name input').val();
                var validate = VALENTINE.validate(name, 10, "告白對象暱稱不可以超過五個字唷（英文不可以超過十個字）!");

                if (validate) {
                    var a = confirm("確定要告白的對象叫做『" + name + "』");
                }

                if (a && validate) {
                    VALENTINE.finish('#step1', '#name');
                    VALENTINE.start('#step2', '#msg');
                    $('#msg input').focus();
                } else {
                    return false
                }
            // }
        },

        msgConfirm: function () {
            // if(event.type == 'click' || event.which == 13 ) {
                var msg = $('#msg input').val();
                var validate = VALENTINE.validate(msg, 40, "告白對象暱稱不可以超過二十個字唷（英文不可以超過四十個字）!");

                if (validate) {
                    var a = confirm("確定要告白的內容是『" + msg + "』");
                }

                if (a && validate) {
                    VALENTINE.finish('#step2', '#msg');
                    VALENTINE.start('#step3', '#link');
                    VALENTINE.submit();
                } else {
                    return false
                }
            // }
        },

        copy: function () {
            // if(event.type == 'click' || event.which == 13 ) {
                $('#step3').removeClass('active').addClass('completed');
            // }
        },

        submit: function () {

            var that = this;
            var $name = $('#name input').val();
            var $msg = $('#msg input').val();
            var $input = $('#link input');
            var obj = {
                name: this.name,
                photo: this.photo,
                who: $name,
                commit: $msg,
                id: this.fbid
            };

            $.post(this.resourse, obj, function(data,status){
                var data = JSON.parse(data);
                that.id = data.id;
                var val = document.location.host + '/valentine_card.html?id=' + that.id;
                console.log(val)
                $input.val(val).attr('data-clipboard-text', val);
            });

        },

        validate: function (str, max, msg) {
            if(str.replace(/[^\x00-\xff]/g,"**").length > max) {
                alert(msg)
                return false
            } else {
                return true
            }
        },

        count: function () {
            $.get("/valentine/api/valentinecount", {}, function(data,status){
                console.log(data)
                data = JSON.parse(data)
                // data.count = 100; 
                if(data.count > 0) {
                    $('#num').text(data.count);

                    $(window).scroll(function(){
                        // console.log('捲動')
                        var he = $('body').scrollTop();
                        if(he > 200) {
                            // $('.cookie.nag').nag('show');  
                            $('.cookie.nag').show(0);          
                        } else {
                            $('.cookie.nag').hide(0);
                            // $('.close').click() 
                        }
                    });
                }
            });
        }
    }
    
    var tagtoo_advertiser_id = 251;
    var tagtoo_ga = document.createElement('script');
    tagtoo_ga.type = 'text/javascript';
    tagtoo_ga.async = true;
    tagtoo_ga.src = '//ad.tagtoo.co/media/ad/track.js';
    var tagtoo_s = document.getElementsByTagName('script')[0];
    tagtoo_s.parentNode.insertBefore(tagtoo_ga, tagtoo_s);

    window.fbAsyncInit = function() {
        FB.init({
            appId: '776675399034344',
            cookie: true, // enable cookies to allow the server to access 
            // the session
            xfbml: true, // parse social plugins on this page
            version: 'v2.1' // use version 2.1
        });
    };

    // Load the SDK asynchronously
    (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s);
        js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
    
    $(function(){
        $( "#name" ).keypress(function( event ) { if ( event.which == 13 ) { event.preventDefault(); VALENTINE.nameConfirm(); } });
        $( "#msg" ).keypress(function( event ) { if ( event.which == 13 ) { event.preventDefault(); VALENTINE.msgConfirm(); } });
        $( "#link" ).keypress(function( event ) { if ( event.which == 13 ) { event.preventDefault(); VALENTINE.copy(); } });

        $( "#name .button" ).on({
            click: VALENTINE.nameConfirm,
            keypress: VALENTINE.nameConfirm
        });

        $( "#msg .button" ).on({
            click: VALENTINE.msgConfirm,
            keypress: VALENTINE.msgConfirm
        });

        $( "#link .button" ).on({
            click: VALENTINE.copy,
            keypress: VALENTINE.copy
        });

        VALENTINE.count();

        var client = new ZeroClipboard( document.getElementById("copy-button") );

        client.on( "ready", function( readyEvent ) {
          // alert( "ZeroClipboard SWF is ready!" );

            client.on( "copy", function (event) {
              var clipboard = event.clipboardData;
              var val = document.location.host + '/valentine_card.html?id=' + VALENTINE.id;
              clipboard.setData("text/plain", val);
            });

          client.on( "aftercopy", function( event ) {
            // `this` === `client`
            // `event.target` === the element that was clicked
            // event.target.style.display = "none";  
            alert("Copied text to clipboard: " + event.data["text/plain"] );
          } );
        } );
    });
    </script>
</body>

</html>
